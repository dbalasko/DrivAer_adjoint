/*--------------------------------*- C++ -*----------------------------------*\
  =========                 |
  \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox
   \\    /   O peration     | Website:  https://openfoam.org
    \\  /    A nd           | Version:  10
     \\/     M anipulation  |
\*---------------------------------------------------------------------------*/
FoamFile
{
    version	2.0;
    format      ascii;
    class       dictionary;
    object      snappyHexMeshDict;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

castellatedMesh true;
snap            true;
addLayers       true;

geometry
{
    body.stl
    {
        type triSurfaceMesh;
	name body;
    }
    
    fastback.stl
    {
        type triSurfaceMesh;
	name optSurface;
    }

    fastback_optSurface.stl
    {
        type triSurfaceMesh;
        name optSurface;
    }
    
    /*front_intakes.stl
    {
        type triSurfaceMesh;
	name frontIntakes;
    }
    
    lights_front.stl
    {

	type triSurfaceMesh;
	name lightsFront;
    }*/

    /*Mirror_stripe.stl
    {

	type triSurfaceMesh;
        name mirrorStripe;
    }*/

    Mirrors.stl
    {

	type triSurfaceMesh;
	name 	body;
    }

    /*tyres_fr.stl
    {

        type triSurfaceMesh;
        name    tyresFront;
    }

    tyres_rear.stl
    {

        type triSurfaceMesh;
        name    tyresRear;
    }
    
    wheels_fr.stl
    {

        type triSurfaceMesh;
        name    wheelsFront;
    }

    wheels_rear.stl
    {

        type triSurfaceMesh;
        name    wheelsRear;
    }

    Underbody_Smooth.stl
    {

        type triSurfaceMesh;
        name    underbody;
    }*/


    windows.stl
    {

        type triSurfaceMesh;
        name    optSurface;
    }

    /*windows_rear.stl
    {

        type triSurfaceMesh;
        name    windowsRear;
    }*/
    
    upstream
    {
    	type searchableBox;
        min (-10 -0.5 -1.5);
        max (10 0.5 1.5);
   }
   
    underbody
    {
    	type searchableBox;
        min (-10 -0.3 -1.5);
        max (3 -0.15 1.5);
   }
   
    wake
    {
    	type searchableBox;
        min (3 -0.3 -1.2);
        max (6 1.1 1.2);
   }
   
   downstream
   {
       	type searchableBox;
        min (3 -0.29 -1.5);
        max (30 1.5 1.5);
   }

   downstream_full_length
   {
   	type searchableBox;
	min (2 -0.29 -1.8);
	max (30 1.8 1.8);
   }
   
  /*wheelBoxRear
   {
       	type searchableBox;
        min (2.386 -0.29 0.6);
        max (3.186 -0.15 0.9);
   }*/
};

castellatedMeshControls
{
    maxLocalCells 2000000;
    maxGlobalCells 5000000;
    maxLoadUnbalance 0.10;
    minRefinementCells 10;
    nCellsBetweenLevels 2;
    
    features
    (
     	/*{
            file "body.eMesh";
            level 4;  // Refinement level along edges
        }

	{
            file "fastback.eMesh";
            level 4;  // Refinement level along edges
        }

	{
            file "fastback_optSurface.eMesh";
            level 4;  // Refinement level along edges
        }*/

	/*{
            file "front_intakes.eMesh";
            level 5;  // Refinement level along edges
        }

	{
            file "lights_front.eMesh";
            level 5;  // Refinement level along edges
        }*/

	/*{
            file "Mirrors.eMesh";
            level 4;  // Refinement level along edges
        }*/

	/*{
            file "Mirror_stripe.eMesh";
            level 6;  // Refinement level along edges
        }*/

	/*{
            file "tyres_fr.eMesh";
            level 5;  // Refinement level along edges
        }

	{
            file "tyres_rear.eMesh";
            level 5;  // Refinement level along edges
        }

	{
            file "Underbody_Smooth.eMesh";
            level 5;  // Refinement level along edges
        }

	{
            file "wheels_fr.eMesh";
            level 5;  // Refinement level along edges
        }

	{
            file "wheels_rear.eMesh";
            level 5;  // Refinement level along edges
        }*/

	/*{
            file "windows.eMesh";
            level 4;  // Refinement level along edges
        }*/

	/*{
            file "windows_rear.eMesh";
            level 4;  // Refinement level along edges
        }*/
    );

    refinementSurfaces
    {
    body { level (6 7); patchInfo { type wall; } }
    optSurface { level (6 7); patchInfo { type wall; } }
    //frontIntakes { level (4 5); patchInfo { type wall; } }
    //lightsFront { level (4 5); patchInfo { type wall; } }
    //mirrorStripe { level (6 6); patchInfo { type wall; } }
    //mirrors { level (5 6); patchInfo { type wall; } }
    //tyresFront { level (5 5); patchInfo { type wall; } }
    
    // Replace wildcards with exact names:
    //tyresRear { level (5 5); patchInfo { type wall; } }
    //underbody { level (4 5); patchInfo { type wall; } }
    
    //wheelsFront { level (4 5); patchInfo { type wall; } }
    //wheelsRear { level (4 5); patchInfo { type wall; } }
    
    //windowsFront { level (4 4); patchInfo { type wall; } }
    //windowsRear { level (4 4); patchInfo { type wall; } }
    }

    resolveFeatureAngle 30;
    

    refinementRegions
    {
       "(body|optSurface)"
       {
             mode distance;
             levels ((0.1 6));
       }
       
       "(wake|underbody)"
       {
             mode inside;
             levels ((5 5));
       }

       ".*stream"
       {
             mode inside;
             levels ((4 4));
       }

       "downstream_full_length"
       {
       		mode inside;
		levels ((3 3));
       }
       
       /*"(wheelBoxFront|wheelBoxRear)"
       {
       	     mode inside;
             levels ((6 6));
       }*/
      
    }

    locationInMesh	(15 1e-5 1e-5);
    nCellsBetweenLevels 5;
    
    allowFreeStandingZoneFaces true;
}

snapControls
{

    nSmoothPatch 3;
    tolerance 2.0;
    nSolveIter 30;
    nRelaxIter 5;

    //- Number of feature edge snapping iterations.
        //  Leave out altogether to disable.
        nFeatureSnapIter 10;

        //- Detect (geometric only) features by sampling the surface
        //  (default=false).
        implicitFeatureSnap false;

        //- Use castellatedMeshControls::features (default = true)
        explicitFeatureSnap true;

        //- Detect points on multiple surfaces (only for explicitFeatureSnap)
        multiRegionFeatureSnap false;
}

addLayersControls
{
    relativeSizes on;
    layers
    {
        "(body|optSurface)"//|tyresFront|tyresRear|wheelsFront|wheelsRear)"
        {
            nSurfaceLayers 2;
        }
        
        
    }

    expansionRatio 1.3;
    finalLayerThickness 0.3;
    minThickness 1e-3;
    nGrow 0;

    // Advanced settings
    featureAngle 60;
    nRelaxIter 10;
    nSmoothSurfaceNormals 20;
    nSmoothNormals 10;
    nSmoothThickness 10;
    maxFaceThicknessRatio 1;
    maxThicknessToMedialRatio 0.6;
    minMedialAxisAngle 130;
    nBufferCellsNoExtrude 0;
    nLayerIter 50;
}

meshQualityControls
{
    maxNonOrtho 60;
    maxBoundarySkewness 20;
    maxInternalSkewness 4;
    maxConcave 80;
    minFlatness 0.5;
    minVol 1e-13;
    minTetQuality 1e-30;
    minArea -1;
    minTwist 0.05;
    minDeterminant 0.001;
    minFaceWeight 0.05;
    minVolRatio 0.01;
    minTriangleTwist -1;


    // Advanced

    nSmoothScale 4;
    errorReduction 0.75;
}

/*debug 0;*/

writeFlags ();

mergeTolerance 1e-6;

// ************************************************************************* //
